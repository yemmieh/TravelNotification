@model MainTravelClass.SearchModel
@using MainTravelClass
@{
    ViewBag.Title = "Admin Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
    @*<script src="@Url.Content("~/Scripts/jquery-1.10.2.min.js")" type="text/javascript"></script>*@
    @*<script src="@Url.Content("~/Scripts/jquery.ui-1.11.4.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/jquery.ui.datepicker.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-1.10.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>*@
     @*<script src="@Url.Content("~/Scripts/jquery-1.10.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.ui.core.min.js")" type="text/javascript"></script>

  <script src="@Url.Content("~/Scripts/jquery.ui.datepicker.min.js")" type="text/javascript"></script>
   
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>*@
}
}
<style>
    input[type='text'], select, .button, textarea {
        width: 100%;
    }

    .form-control {
        width: 100%;
    }
</style>

<div class="contentBody secondcontentBody card" style="margin-top:1px;">
    <div style="display:block;">
        <span class="requester_details" align="right"></span>
    </div>
</div>


@using (Html.BeginForm("SearchSubmit", "Search", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
{
    <div class="contentBody secondcontentBody card" style="margin-top:-25px;">
        <span class="stf_table_title" align="left">Search Entries »</span>
        <div align="left" class="line"></div>
        <div class="stf_optionsContainer">
            <div class="row">
                <div class="col-md-3">
                    
                    <h2>Requester ID:</h2><hr>
                    @Html.TextBoxFor(model => model.InitiatorId, new {id = "InitiatorId" })
                </div>
                <div class="col-md-3">
                    <h2>Requester Name:</h2>

                    @Html.TextBoxFor(model => model.InitiatorName, new {id = "InitiatorName" })


                </div>
                <div class="col-md-3">
                    <h2>Account Number:</h2>
                    @Html.TextBoxFor(model => model.AccountNumber, new {id = "AccountNumber" })               

                </div>
                <div class="col-md-3">
                    <h2>Account Name:</h2>
                    @Html.TextBoxFor(model => model.AccountName, new {id = "AccountName" })
                </div>
            </div>

            <br /><br />
            <div class="row">
                <div class="col-md-3">
                    <h2>Branch:</h2>  
                    @Html.HiddenFor(model => model.BranchCode)                
                    @Html.DropDownListFor(m => m.branchName,new SearchAppClass().getBranchesNew(), "Select a branch", new { @class = "form-control" })
                </div>


                <div class="col-md-3">
                    <h2>Department:</h2>
                    @Html.HiddenFor(model => model.Dept_id)                    
                    @Html.DropDownListFor(m => m.Dept, new SearchAppClass().getDepartment(), "--Select a Department--", new { @class = "form-control" })
                </div>

                <div class="col-md-3">
                    <h2>Domicile Branch:</h2>
                    @Html.HiddenFor(model => model.DomicileBranchCode)                    
                    @Html.DropDownListFor(m => m.DomicileBranch, new SearchAppClass().getBranchesNew(), "Select a branch", new { @class = "form-control" })                 
                </div>

                <div class="col-md-3">
                    <h2>Request Stage:</h2>
                    @Html.DropDownListFor(m => m.RequestStage, new SearchAppClass().GetRequestStages(), "Select a approval stages", new { @class = "form-control" })
                    
                </div>
            </div>
            <br /><br />
            <div class="row">
                <div class="col-md-3">
                    <h2>Date Submitted:</h2>
                    <td>@Html.TextBoxFor(model => model.Date_Submit_From, new { id = "Date_Submit_From", type = "datetime", @class = "datepicker form-control", placeholder = "Start Date" })

</div>

                <div class="col-md-3">
                    <h2>:</h2>
                    <td>@Html.TextBoxFor(model => model.Date_Submit_To, new { id = "Date_Submit_To", type = "datetime", @class = "datepicker form-control", placeholder = "End Date" })


</div>
                <div class="col-md-3">
                    <h2>Date Approved:</h2>
                    <td>
                        @Html.TextBoxFor(model => model.Date_Approve_From, new { id = "Date_Approve_From", type = "datetime", @class = "datepicker form-control ", placeholder = "Start date" })


                    @*@Html.TextBoxFor(model => model.Date_Submit_From, new { id = "Date_Submit_From", type = "datetime", @class = "datepicker form-control", placeholder = "Start Date" })
        @Html.TextBoxFor(model => model.Date_Submit_To, new { id = "Date_Submit_To", type = "datetime", @class = "datepicker form-control", placeholder = "End Date" })*@

</div>

                <div class="col-md-3">
                    <h2>: </h2>
                    <td>
                        @Html.TextBoxFor(model => model.Date_Approve_To, new { id = "Date_Approve_To", type = "datetime", @class = "datepicker form-control jqueryui-marker-datepicker date-picker", placeholder = "End date" })
                    @*<input class="date-picker" />
        @Html.TextBox("YourTextBox", "", new { @class = "date-picker" })
        @Html.JQueryUI().DatepickerFor(model => model.Date_Approve_To)*@

                    @*@Html.TextBoxFor(model => model.Date_Approve_From, new { id = "Date_Approve_From", type = "datetime", @class = "datepicker form-control", placeholder = "Start date" })
        @Html.TextBoxFor(model => model.Date_Approve_To, new { id = "Date_Approve_To", type = "datetime", @class = "datepicker form-control", placeholder = "End date" })*@
</div>

            </div>
            <br />
            <br />
            <div class="row">
                <div class="col-md-3">
                    <h2>Export To Export:</h2>
                    @Html.EditorFor(model => model.ExportToExport)
                </div>


            </div>
        </div>
    </div>

    
    <div class="contentBody secondcontentBody card" style="margin-top:-25px;">
        <div class="stf_optionsContainer">
            <input class="submitBtn buttons-blue buttons" type="submit" name="submit" />
        </div>

        <div class="form-group">
            <div class="col-md-offset-3 col-md-9">
                <span class='web-err'>@ViewBag.ErrorMessage</span>
            </div>
        </div>
        <br /><br />
        <div style="margin-top:17px;">
          
            @if (Model != null)
            {                 
                ViewBag.HasGrid = true;
                int rowNum = 0;
            
                var grid = new WebGrid(
                                canPage: true,
                                rowsPerPage: 100,
                                canSort: true,
                                ajaxUpdateContainerId: "grid"
                                );

                grid.Bind(Model.Requests);
                grid.Pager(WebGridPagerModes.All);
                @grid.GetHtml(htmlAttributes: new { id = "grid" },
                            tableStyle: "viewTable",
                            fillEmptyRows: false,
                            headerStyle: "viewTableHeader",
                            mode: WebGridPagerModes.All,
                            columns: grid.Columns(

                            grid.Column("S/NO", format: item => rowNum = rowNum + 1),
                            grid.Column("travel_request.Accountdetails.AccountNo", "ACCOUNT NUMBER"),
                            //grid.Column(header: "ACCOUNT NAME", format: (item) => new HtmlString(Html.ActionLink((string)item.travel_request.Accountdetails.Account_Name, "ExplodeProject", new { id = item.travel_request.id }).ToString())),
                                 grid.Column("ACCOUNT NAME", format: (item) => Html.ActionLink((string)item.travel_request.Accountdetails.Account_Name, "ExplodeTravelrequest", "Travel", new { id = item.travel_request.id }, null)),
                            grid.Column("travel_request.Accountdetails.DomicileBranch", "DOMICILE BRANCH"),
                            grid.Column("travel_request.StaffProfile.Staffname", "REQUESTER"),
                            grid.Column("travel_request.StaffProfile.Branch", "REQUESTING BRANCH"),
                            grid.Column("travel_request.Date_Submitted", "DATE SUBMITTED"),
                            grid.Column("travel_request.ApprovalStage", "REQUEST STAGE"),
                            grid.Column( "Approvers",format: @<a href="javascript:getApprovers('@item.travel_request.id');"><span class="glyphicon glyphicon-user"></span></a>,
                            style:"text-center"
                        )

                ));
                 <h2>@grid.TotalRowCount</h2>
            }
            else
            {
                <h1>No Record To Display</h1>
            }


        </div>
    </div>
        <style>
            .viewTableHeader th a {
                color: white;
            }
        </style>
    
    
}


@Scripts.Render("~/bundles/jqueryui")


@*<script type="text/javascript">
    $(function () {
        // This will make every element with the class "date-picker" into a DatePicker element
        $('.date-picker').datepicker();
    })
</script>*@





<script language="javascript" type="text/javascript">
    $(function () {
        $('input[type=datetime]').datepicker({
            dateFormat: "yy/mm/dd",
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0"
        });
    });


    function getApprovers(workflowid) {
        console.log(workflowid.toString());
        $.ajax({
            type: "POST",
            url: "../Travel/GetApprovers",
            traditional: true,
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ WorkflowID: workflowid }),
            success: function (data) {
                console.log(data)
                //alert(data);
                if (data != undefined || data[0] != null) {
                    //alert(data.name);
                    if (data.employee_number == "" || data.employee_number == "Error") {
                        alert(data.name);
                    } else {
                        data = "APPROVERS:\n\n" + data.toString().replace(/,/g, "\n")
                        alert(data);
                    }
                }

                /*var StaffName = "";

                if (data[0] == undefined || data[0] == null) {
                    StaffName = data.name;
                    StaffNumber = data.employee_number;
                    StaffGrade = data.grade_code;

                    $("#StaffName").val("");
                    $("#StaffNumber").val("");
                    $("#StaffGrade").val("");

                    $(".web-err").html(StaffNumber + "_" + StaffName);

                } else {
                    StaffName = data[0].name;
                    StaffNumber = data[0].employee_number;
                    StaffGrade = data[0].grade_code;

                    $("#StaffName").val(StaffName);
                    $("#StaffNumber").val(StaffNumber);
                    $("#StaffGrade").val(StaffGrade);

                    $(".web-err").html("");
                }*/

            }, error: function (data) {
                //console.log(data)
            }
        });
    }

</script>